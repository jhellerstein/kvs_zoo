# cargo-nextest configuration for kvs_zoo
# See https://nexte.st/book/configuration.html
nextest-version = "0.9.55"

[profile.default]
retries = 0
failure-output = "immediate"
success-output = "never"
fail-fast = false
# Full parallelism for unrelated tests.
test-threads = "num-cpus"

# Serialize only the tests that spin up Hydro deployments using trybuild; we match by test name patterns.
[test-groups.hydro-trybuild]
max-threads = 1

# Use filterset DSL: test(name) matches individual tests; we combine with or.
[[profile.default.overrides]]
filter = 'test(example_linearizable_paxos_lww) or test(example_local_lww) or test(example_replicated_none) or test(example_replicated_broadcast) or test(example_sharded_local) or test(test_replicated_kvs_with_no_replication) or test(test_paxos_provides_global_ordering) or test(test_linearizable_reads_see_writes) or test(test_concurrent_operations_are_linearized)'
test-group = "hydro-trybuild"

# Dedicated CI profile: enable retries for transient startup/link races.
[profile.ci]
retries = { backoff = "fixed", count = 2, delay = "500ms" }
fail-fast = false
failure-output = "immediate-final"
success-output = "never"
